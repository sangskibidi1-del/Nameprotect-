local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local CoreGui = game:GetService("CoreGui")

-- Bảng map fake name
local nameMap = {}
local counter = 1
local prefix = "Protect"

-- LocalPlayer luôn là NameProtect
nameMap[LocalPlayer] = "NameProtect"

-- Hàm fake tên
local function getFakeName(plr)
    if not nameMap[plr] then
        nameMap[plr] = prefix .. tostring(counter)
        counter += 1
    end
    return nameMap[plr]
end

-- Hàm thay text
local function replaceText(obj)
    if obj:IsA("TextLabel") or obj:IsA("TextButton") or obj:IsA("TextBox") then
        for plr, fake in pairs(nameMap) do
            if obj.Text and (obj.Text:find(plr.Name) or obj.Text:find(plr.DisplayName)) then
                obj.Text = obj.Text:gsub(plr.Name, fake)
                obj.Text = obj.Text:gsub(plr.DisplayName, fake)
            end
        end
    end
end

-- Quét GUI
local function scanUI()
    for _, gui in ipairs({LocalPlayer.PlayerGui, CoreGui}) do
        for _, obj in ipairs(gui:GetDescendants()) do
            replaceText(obj)
        end
    end
end

-- Đổi tên trên đầu nhân vật
local function updateChar(plr)
    local fake = getFakeName(plr)
    if plr.Character and plr.Character:FindFirstChild("Humanoid") then
        plr.Character.Humanoid.DisplayName = fake
    end
end

-- Setup ban đầu
for _, plr in ipairs(Players:GetPlayers()) do
    getFakeName(plr)
    updateChar(plr)
end

-- Người mới vào
Players.PlayerAdded:Connect(function(plr)
    getFakeName(plr)
    plr.CharacterAdded:Connect(function()
        updateChar(plr)
    end)
end)

-- Cập nhật liên tục nhưng nhẹ
task.spawn(function()
    while task.wait(0.05) do -- mặc định an toàn
        scanUI()
        for _, plr in ipairs(Players:GetPlayers()) do
            updateChar(plr)
        end
    end
end)

-- Watermark
local gui = Instance.new("ScreenGui", LocalPlayer.PlayerGui)
gui.IgnoreGuiInset = true
local label = Instance.new("TextLabel", gui)
label.Size = UDim2.new(1, 0, 0, 50)
label.BackgroundTransparency = 1
label.Text = "✨ Made by ChatGPT ✨"
label.TextColor3 = Color3.fromRGB(0, 255, 127)
label.TextScaled = true
task.delay(5, function() gui:Destroy() end)
